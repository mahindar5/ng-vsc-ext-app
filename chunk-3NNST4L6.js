import{a as se,c as re}from"./chunk-HRN6ZELQ.js";import{b as Ee}from"./chunk-VAKQXI3J.js";import{a as Se,b as ye}from"./chunk-B3FCKRH5.js";import{a as he,b as fe,c as we,d as Ce,f as Me,g as b,h as ve}from"./chunk-LULFY4RM.js";import{a as te,c as ie,e as ne}from"./chunk-U5K5244M.js";import"./chunk-ZBVV545M.js";import{a as me,b as de,c as pe,d as ue,h as xe}from"./chunk-7BGUQOWY.js";import{a as _e,b as ge}from"./chunk-7WZJHJDG.js";import{M as le,N as ce,d as Y,g as j}from"./chunk-MQMBVYYN.js";import{$ as H,$a as r,Eb as A,Fa as Q,Gb as F,Mb as q,Sb as X,Ta as I,Ua as S,Va as y,Ya as z,Z as B,Za as V,_a as x,a as _,ab as n,b as g,bb as p,da as D,db as R,dc as J,ea as L,fb as v,fd as G,gb as w,kd as Z,ma as P,md as ee,nd as oe,ob as N,od as ae,pb as W,ua as $,ub as l,vb as d,wa as s,wb as U}from"./chunk-LIMSH4HP.js";var Ae=(a,c)=>c.id;function Ie(a,c){if(a&1&&(r(0,"mat-card")(1,"mat-card-content")(2,"div",7)(3,"div")(4,"strong"),l(5),n(),p(6,"br"),l(7,"Files"),n(),r(8,"div")(9,"strong"),l(10),n(),p(11,"br"),l(12,"Questions"),n(),r(13,"div")(14,"strong"),l(15),n(),p(16,"br"),l(17,"Unique"),n(),r(18,"div")(19,"strong"),l(20),n(),p(21,"br"),l(22,"Duplicates"),n(),r(23,"div")(24,"strong"),l(25),n(),p(26,"br"),l(27,"Answered"),n(),r(28,"div")(29,"strong"),l(30),n(),p(31,"br"),l(32,"Unanswered"),n(),r(33,"div")(34,"strong"),l(35),n(),p(36,"br"),l(37,"Correct"),n(),r(38,"div")(39,"strong"),l(40),n(),p(41,"br"),l(42,"Wrong"),n()()()()),a&2){let e=c;s(5),d(e.totalFiles),s(5),d(e.totalQuestions),s(5),d(e.uniqueQuestions),s(5),d(e.duplicateCount),s(5),d(e.answered),s(5),d(e.unanswered),s(5),d(e.correct),s(5),d(e.wrong)}}function Fe(a,c){if(a&1&&(r(0,"mat-icon",11),l(1),n()),a&2){let e=w().$implicit;x("color",e.isCorrect?"primary":e.userSelected?"warn":""),s(),U(" ",e.isCorrect?"check_circle":e.userSelected?"cancel":""," ")}}function qe(a,c){if(a&1){let e=R();r(0,"mat-list-item")(1,"mat-checkbox",10),v("change",function(){let t=D(e).$implicit,o=w().$implicit,m=w(2);return L(m.toggleChoiceSelection(o.id,t.id))}),n(),S(2,Fe,2,2,"mat-icon",11),p(3,"div",12),n()}if(a&2){let e=c.$implicit,i=w().$implicit;s(),x("checked",e.userSelected)("disabled",i.showAnswer),s(),y(i.showAnswer?2:-1),s(),x("innerHTML",e.textHtml,$)}}function ke(a,c){if(a&1&&p(0,"mat-divider")(1,"div",13),a&2){let e=w().$implicit;s(),x("innerHTML",e.rationaleHtml,$)}}function He(a,c){if(a&1){let e=R();r(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"span"),l(4),n(),r(5,"mat-chip"),l(6),n(),r(7,"mat-chip"),l(8),n(),r(9,"button",4),v("click",function(t){let o=D(e).$implicit;return w(2).toggleQuestionAnswer(o.id),L(t.stopPropagation())}),r(10,"mat-icon"),l(11),n()(),r(12,"button",9)(13,"mat-icon"),l(14,"info"),n()()()(),r(15,"mat-list"),z(16,qe,4,4,"mat-list-item",null,Ae),n(),S(18,ke,2,1),n()}if(a&2){let e=c.$implicit;s(4),d(e.text),s(2),d(e.type),s(2),d(e.count),s(),x("matTooltip",A(e.showAnswer?"Hide answer":"Show answer")),I("aria-label",e.showAnswer?"Hide answer":"Show answer"),s(2),d(e.showAnswer?"visibility_off":"visibility"),s(),x("matTooltip",A(e.sources.join(`
`))),s(4),V(e.choices),s(2),y(e.rationaleHtml?18:-1)}}function De(a,c){if(a&1&&(r(0,"mat-card")(1,"mat-card-content")(2,"mat-accordion",8,0),z(4,He,19,10,"mat-expansion-panel",null,Ae),n()()()),a&2){let e=w();s(4),V(e.questions())}}var K=new B("ExamDataParser"),k=class{parser=H(K);questions=new Map;initialize(){this.questions.clear()}normalizeText(c){return c.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}generateQuestionKey(c){let e=this.normalizeText(c.text),i=c.choices.map(t=>this.normalizeText(t.text)).sort().join("|");return`${e}:::${i}`}async processFiles(c){this.initialize();let e=await this.parser.parseFiles(c),i=new Map,t=c.filter(o=>o.name.endsWith(".json")).map(o=>o.name);for(let o of e){let m=this.generateQuestionKey(o);if(this.questions.has(m)){let u=this.questions.get(m);u.count++}else{let u=g(_({},o),{count:1,sources:t,showAnswer:!1});this.questions.set(m,u)}}}getDeduplicatedQuestions(){return Array.from(this.questions.values()).sort((c,e)=>e.count-c.count)}getStats(c){let e=c||Array.from(this.questions.values()),i=e.reduce((h,f)=>h+f.count,0),t=e.length,o=i-t,m=new Set;e.forEach(h=>h.sources.forEach(f=>m.add(f)));let u=e.filter(h=>h.choices.some(f=>f.userSelected)).length,C=t-u,T=e.filter(h=>{let f=h.choices.filter(M=>M.userSelected),Te=h.choices.filter(M=>M.isCorrect);return f.length>0&&f.every(M=>M.isCorrect)&&Te.every(M=>M.userSelected)}).length,E=u-T;return{totalFiles:m.size,totalQuestions:i,uniqueQuestions:t,duplicateCount:o,answered:u,unanswered:C,correct:T,wrong:E}}},be=(()=>{class a{service=H(k);cacheKey="examQuestionManager_directoryHandle";questions=P([]);expandedState=P(!0);accordion=X(b);stats=q(()=>{let e=this.questions();return e.length>0?this.service.getStats(e):null});hasQuestions=q(()=>this.questions().length>0);allExpanded=q(()=>this.expandedState());constructor(){this.service.initialize(),this.loadCached()}async loadCached(){let e=await j.getItem(this.cacheKey,!1);e&&this.processDirectory(e)}async saveToCache(e){await j.setItem(this.cacheKey,e,void 0,Y,!1)}toggleAllAccordions(){let e=this.accordion();this.expandedState()?(e?.closeAll(),this.expandedState.set(!1)):(e?.openAll(),this.expandedState.set(!0))}updateQuestions(e){this.questions.set(e(this.questions()))}toggleAllAnswers(){let e=this.questions().every(i=>i.showAnswer);this.updateQuestions(i=>i.map(t=>g(_({},t),{showAnswer:!e})))}toggleQuestionAnswer(e){this.updateQuestions(i=>i.map(t=>t.id===e?g(_({},t),{showAnswer:!t.showAnswer}):t))}toggleChoiceSelection(e,i){this.updateQuestions(t=>t.map(o=>o.id===e?g(_({},o),{choices:o.choices.map(m=>m.id===i?g(_({},m),{userSelected:!m.userSelected}):m)}):o))}resetAllSelections(){this.updateQuestions(e=>e.map(i=>g(_({},i),{showAnswer:!1,choices:i.choices.map(t=>g(_({},t),{userSelected:!1}))})))}areAllAnswersVisible(){let e=this.questions();return e.length>0&&e.every(i=>i.showAnswer)}async onSelectFolder(){let e=await window.showDirectoryPicker();await this.saveToCache(e),this.processDirectory(e)}async processDirectory(e){let i=await this.getFiles(e);await this.service.processFiles(i),this.questions.set(this.service.getDeduplicatedQuestions()),setTimeout(()=>this.accordion()?.openAll())}async getFiles(e){let i=[];for await(let[t,o]of e.entries())o.kind==="file"&&t.endsWith(".json")?i.push(await o.getFile()):o.kind==="directory"&&i.push(...await this.getFiles(o));return i}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=Q({type:a,selectors:[["app-exam-question-manager"]],viewQuery:function(i,t){i&1&&N(t.accordion,b,5),i&2&&W()},features:[F([k])],decls:20,vars:10,consts:[["accordion",""],["color","primary"],[1,"spacer"],["mat-raised-button","","color","accent",3,"click"],["mat-icon-button","",3,"click","matTooltip"],["mat-icon-button","","aria-label","Reset all selections","matTooltip","Reset all selections",3,"click"],[1,"container"],[1,"stats-grid"],["multi",""],["mat-icon-button","",3,"matTooltip"],["matListItemIcon","",3,"change","checked","disabled"],["matListItemIcon","",3,"color"],["matListItemTitle","",3,"innerHTML"],[3,"innerHTML"]],template:function(i,t){if(i&1&&(r(0,"mat-toolbar",1)(1,"span"),l(2,"Exam Question Manager"),n(),p(3,"span",2),r(4,"button",3),v("click",function(){return t.onSelectFolder()}),r(5,"mat-icon"),l(6,"folder_open"),n(),l(7," Select Folder "),n(),r(8,"button",4),v("click",function(){return t.toggleAllAccordions()}),r(9,"mat-icon"),l(10),n()(),r(11,"button",4),v("click",function(){return t.toggleAllAnswers()}),r(12,"mat-icon"),l(13),n()(),r(14,"button",5),v("click",function(){return t.resetAllSelections()}),r(15,"mat-icon"),l(16,"refresh"),n()()(),r(17,"div",6),S(18,Ie,43,8,"mat-card"),S(19,De,6,0,"mat-card"),n()),i&2){let o;s(8),x("matTooltip",A(t.allExpanded()?"Collapse all":"Expand all")),I("aria-label",t.allExpanded()?"Collapse all":"Expand all"),s(2),d(t.allExpanded()?"unfold_less":"unfold_more"),s(),x("matTooltip",A(t.areAllAnswersVisible()?"Hide all answers":"Show all answers")),I("aria-label",t.areAllAnswersVisible()?"Hide all answers":"Show all answers"),s(2),d(t.areAllAnswersVisible()?"quiz":"help_outline"),s(5),y((o=t.stats())?18:-1,o),s(),y(t.hasQuestions()?19:-1)}},dependencies:[J,fe,he,ee,Z,G,ae,oe,ne,te,ie,ge,_e,re,se,Ee,ve,b,we,Ce,Me,xe,pe,ue,de,le,me,ce,ye,Se],styles:[".spacer[_ngcontent-%COMP%]{flex:1 1 auto}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;text-align:center}@media (max-width: 768px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}"],changeDetection:0})}return a})();var O=class{async parseFiles(c){let e=[],i=1;for(let t of c)if(t.name.endsWith(".json"))try{let o=await this.readFileContent(t),m=JSON.parse(o);for(let u of m.questionnaires)for(let C of u.questions){let T={id:i++,text:C.text,textHtml:C.textHtml,rationaleHtml:C.rationaleHtml,type:C.type,choices:C.choices.map(E=>({id:E.id,text:E.text,textHtml:E.textHtml,isCorrect:E.isCorrect,userSelected:!1}))};e.push(T)}}catch(o){console.error(`Error parsing Microsoft exam file ${t.name}:`,o)}return e}readFileContent(c){return c.text()}},mt=(()=>{class a{static \u0275fac=function(i){return new(i||a)};static \u0275cmp=Q({type:a,selectors:[["app-microsoft-exam-manager"]],features:[F([{provide:K,useClass:O}])],decls:1,vars:0,template:function(i,t){i&1&&p(0,"app-exam-question-manager")},dependencies:[be],encapsulation:2})}return a})();export{O as MicrosoftExamDataParser,mt as MicrosoftExamManagerComponent};
