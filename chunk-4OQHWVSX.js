import{a as ae,b as le}from"./chunk-VAKQXI3J.js";import{c as N,d as j,e as G,f as H,g as J,h as K,i as te,j as ie}from"./chunk-6LA7FJAB.js";import{c as X,d as Y,h as ee}from"./chunk-FTHJ466O.js";import{a as ne,b as oe}from"./chunk-7WZJHJDG.js";import{o as Z}from"./chunk-QUC6PD2A.js";import{$ as h,$a as o,Ab as A,Eb as P,Fa as M,Rb as B,Sb as L,Ua as C,Ub as O,Va as F,Ya as y,Za as V,_a as v,a as b,ab as a,b as S,bb as x,da as d,db as f,ea as m,fb as u,fd as z,gb as c,kd as Q,lc as $,md as w,nd as W,ob as k,oc as I,od as q,pb as T,tc as U,ub as r,vb as D,wa as s,yb as E,zb as R}from"./chunk-LIMSH4HP.js";var se=["dropZone"],ce=(n,_)=>_.path;function de(n,_){if(n&1){let e=f();o(0,"button",11),u("click",function(){d(e);let i=c();return m(i.toggleSelectAllFiles())}),o(1,"mat-icon"),r(2,"check_circle"),a()()}}function me(n,_){if(n&1){let e=f();o(0,"button",12),u("click",function(){d(e);let i=c();return m(i.saveAllFiles())}),o(1,"mat-icon"),r(2,"save"),a()()}}function pe(n,_){if(n&1){let e=f();o(0,"button",13),u("click",function(){d(e);let i=c();return m(i.clearFiles())}),o(1,"mat-icon"),r(2,"delete"),a()()}}function _e(n,_){if(n&1){let e=f();o(0,"button",23),u("click",function(){d(e);let i=c(2).$implicit,l=c();return m(l.saveFile(i))}),o(1,"mat-icon"),r(2,"save"),a()()}}function ue(n,_){if(n&1){let e=f();C(0,_e,3,0,"button",21),o(1,"button",22),u("click",function(){d(e);let i=c().$implicit,l=c();return m(l.saveFileAs(i))}),o(2,"mat-icon"),r(3,"file_copy"),a()()}if(n&2){let e=c().$implicit;F(e.handle?0:-1)}}function ge(n,_){if(n&1&&x(0,"span",25),n&2){let e=c(2).$implicit;v("matBadge",P(e.referencesCount))}}function fe(n,_){if(n&1){let e=f();o(0,"button",24),u("click",function(){d(e);let i=c().$implicit,l=c();return m(l.openReferenceModal(i))}),C(1,ge,1,2,"span",25),o(2,"mat-icon"),r(3,"share"),a()()}if(n&2){let e=c().$implicit;s(),F(e.referencesCount?1:-1)}}function Ce(n,_){if(n&1){let e=f();o(0,"div",10),x(1,"mat-progress-bar",14),o(2,"mat-list-item",15)(3,"div",16)(4,"mat-checkbox",17),A("ngModelChange",function(i){let l=d(e).$implicit;return R(l.selected,i)||(l.selected=i),m(i)}),a(),o(5,"span",18),r(6),a(),o(7,"div",19),C(8,ue,4,1),C(9,fe,4,1,"button",20),a()()()()}if(n&2){let e=_.$implicit,t=c();s(),v("mode",e.status==="inprogress"?"indeterminate":"determinate")("value",t.getProgressValue(e)*100)("color",e.status==="error"?"warn":"primary"),s(),v("title",e.error+`

`+e.code),s(2),E("ngModel",e.selected),s(2),D(e.path),s(2),F(e.code!=null&&e.code.trim()?8:-1),s(),F(t.acceptReferences()?9:-1)}}var $e=(()=>{class n{fileService=h(Z);dialog=h(N);dropZoneRef=L("dropZone");allFiles=O.required();acceptReferences=B(!1);constructor(){}async openReferenceModal(e){let{FileManagerModalComponent:t}=await import("./chunk-FZWDWKBB.js");this.dialog.open(t,{width:"80vw",height:"80vh",data:{allFiles:e.references||[],acceptReferences:this.acceptReferences()}}).afterClosed().subscribe(l=>{let p=l?.allFiles;p&&(e.references=p,e.referencesCount=p.filter(g=>g.selected).length,this.allFiles.set([...this.allFiles()]))})}toggleSelectAllFiles(){let e=this.allFiles().every(t=>t.selected);this.allFiles.set(this.allFiles().map(t=>S(b({},t),{selected:!e})))}onDragOver(e){e.preventDefault(),this.dropZoneRef()?.nativeElement.classList.add("drag-over")}onDragLeave(e){e.preventDefault(),this.dropZoneRef()?.nativeElement.classList.remove("drag-over")}async onFileDrop(e){e.preventDefault(),this.dropZoneRef()?.nativeElement.classList.remove("drag-over"),await this.updateFiles(()=>this.fileService.handleDrop(e))}async selectFolder(){await this.updateFiles(()=>this.fileService.selectFolder())}async selectFiles(){await this.updateFiles(()=>this.fileService.selectFiles())}async saveFile(e){e.handle?await this.fileService.writeToFile(e):await this.saveFileAs(e)}async saveFileAs(e){let t=await this.fileService.saveFileAs(e);t&&this.allFiles.set(this.allFiles().map(i=>i.path===e.path?t:i))}async saveAllFiles(){let e=this.allFiles().map(t=>this.saveFile(t));await Promise.all(e)}hasUnsavedChanges(){return this.allFiles().some(e=>e.status==="done"&&e.code?.trim())}clearFiles(){this.allFiles.set([])}getProgressValue(e){return e.status==="done"?1:e.status==="error"||e.status==="unmodified"?.5:0}async updateFiles(e){let t=await e();if(t.length===0)return;let i=this.allFiles();if(i.length===0){this.allFiles.set(t);return}this.dialog.open(Fe).afterClosed().subscribe(p=>{p==="replace"?this.allFiles.set(t):p==="append"&&this.allFiles.set([...i,...t.filter(g=>!i.some(re=>re.path===g.path))])})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-file-manager"]],viewQuery:function(t,i){t&1&&k(i.dropZoneRef,se,5),t&2&&T()},inputs:{allFiles:[1,"allFiles"],acceptReferences:[1,"acceptReferences"]},outputs:{allFiles:"allFilesChange"},decls:18,vars:3,consts:[["dropZone",""],[1,"file-manager"],[1,"button-container"],["mat-icon-button","","title","Select All"],["mat-icon-button","","title","Select Files",3,"click"],["mat-icon-button","","title","Select Folder",3,"click"],["mat-icon-button","","title","Save All"],["mat-icon-button","","title","Clear Files"],[1,"drop-zone",3,"dragover","dragleave","drop"],[1,"drop-message"],[1,"file-item"],["mat-icon-button","","title","Select All",3,"click"],["mat-icon-button","","title","Save All",3,"click"],["mat-icon-button","","title","Clear Files",3,"click"],[3,"mode","value","color"],[3,"title"],[1,"file-content"],[3,"ngModelChange","ngModel"],[1,"file-path"],[1,"file-actions"],["mat-icon-button","","title","Accept"],["mat-icon-button","","title","Save"],["mat-icon-button","","title","Save As",3,"click"],["mat-icon-button","","title","Save",3,"click"],["mat-icon-button","","title","Accept",3,"click"],["matBadgeColor","primary",3,"matBadge"]],template:function(t,i){if(t&1){let l=f();o(0,"div",1)(1,"div",2),C(2,de,3,0,"button",3),o(3,"button",4),u("click",function(){return d(l),m(i.selectFiles())}),o(4,"mat-icon"),r(5,"description"),a()(),o(6,"button",5),u("click",function(){return d(l),m(i.selectFolder())}),o(7,"mat-icon"),r(8,"folder"),a()(),C(9,me,3,0,"button",6),C(10,pe,3,0,"button",7),a(),o(11,"div",8,0),u("dragover",function(g){return d(l),m(i.onDragOver(g))})("dragleave",function(g){return d(l),m(i.onDragLeave(g))})("drop",function(g){return d(l),m(i.onFileDrop(g))}),o(13,"div",9),r(14,"Drag and drop files here"),a()(),o(15,"mat-list"),y(16,Ce,10,8,"div",10,ce),a()()}t&2&&(s(2),F(i.allFiles().length>0?2:-1),s(7),F(i.hasUnsavedChanges()?9:-1),s(),F(i.allFiles().length>0?10:-1),s(6),V(i.allFiles()))},dependencies:[U,$,I,w,z,oe,ne,q,W,ee,X,Y,ie,te,le,ae],styles:[".file-manager[_ngcontent-%COMP%]{padding:8px}.drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--mat-sys-primary);border-radius:4px;margin-bottom:20px;padding:20px;text-align:center}.drop-zone.drag-over[_ngcontent-%COMP%]{border-color:var(--mat-sys-primary)}.button-container[_ngcontent-%COMP%]{display:flex;gap:4px;margin-bottom:8px}.file-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0}.file-path[_ngcontent-%COMP%]{flex:1;margin-left:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-actions[_ngcontent-%COMP%]{display:flex;gap:4px}"]})}return n})(),Fe=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["file-update-dialog"]],decls:12,vars:3,consts:[["mat-dialog-title",""],["align","end"],["mat-button","",3,"mat-dialog-close"],["mat-button","","color","primary",3,"mat-dialog-close"]],template:function(t,i){t&1&&(o(0,"h2",0),r(1,"Replace the list of Files"),a(),o(2,"mat-dialog-content")(3,"p"),r(4,"Do you want to append, replace, or skip to add them?"),a()(),o(5,"mat-dialog-actions",1)(6,"button",2),r(7,"Replace"),a(),o(8,"button",2),r(9,"Skip"),a(),o(10,"button",3),r(11,"Append"),a()()),t&2&&(s(6),v("mat-dialog-close","replace"),s(2),v("mat-dialog-close","cancel"),s(2),v("mat-dialog-close","append"))},dependencies:[w,Q,K,j,G,J,H],encapsulation:2})}return n})();export{$e as a};
