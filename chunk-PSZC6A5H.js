import{a as Te}from"./chunk-3DA34C4J.js";import{a as ve,b as Me,c as be,d as xe}from"./chunk-O7ND7HTR.js";import{b as Se}from"./chunk-4OR4T2JR.js";import"./chunk-J6RROGOB.js";import"./chunk-OANBSMPN.js";import{a as ae,b as oe,c as se}from"./chunk-HRN6ZELQ.js";import"./chunk-MKNU5KZH.js";import"./chunk-YZHBBPAW.js";import{a as ie,b as ne}from"./chunk-5PWFBBMJ.js";import"./chunk-Q3H3C2UG.js";import{b as re,d as le,e as me,f as ce,g as de,h as pe,i as Ce,j as _e}from"./chunk-62VGTODQ.js";import{a as we,b as ye}from"./chunk-LULFY4RM.js";import{e as W}from"./chunk-U5K5244M.js";import{a as X,c as Y,f as Z}from"./chunk-ZBVV545M.js";import{e as he,g as fe,h as E}from"./chunk-7BGUQOWY.js";import"./chunk-7WZJHJDG.js";import{M as ge,N as ue,b as k,j as A,o as q}from"./chunk-MQMBVYYN.js";import{$ as v,$a as a,Bb as F,Cb as $,Db as Q,Fa as b,Gb as N,Ia as O,Sb as R,Ua as f,Va as C,Xa as D,Ya as x,Za as w,_a as c,ab as s,bb as h,da as p,db as y,ea as g,fb as u,fd as G,gb as S,hc as H,kd as J,lc as U,ma as M,md as P,nd as ee,ob as V,oc as j,od as te,pb as I,qb as B,tb as L,tc as K,ub as l,vb as T,wa as r,wb as z}from"./chunk-LIMSH4HP.js";var ke=["chatContent"];function Ae(o,d){if(o&1&&(a(0,"div",14)(1,"div",15)(2,"mat-icon"),l(3),s()(),a(4,"div",16)(5,"pre",17),l(6),s()()(),h(7,"mat-divider")),o&2){let i=d.$implicit;r(),L(i.role),r(2),T(i.role==="user"?"person":"android"),r(3),T(i.text)}}function Pe(o,d){if(o&1&&(a(0,"div",8),x(1,Ae,8,4,null,null,D),s()),o&2){S();let i=Q(14);r(),w(i)}}function Ee(o,d){if(o&1){let i=y();a(0,"mat-chip",9),u("click",function(){p(i);let e=S();return g(e.summarizeActivePage(!0))}),a(1,"mat-icon"),l(2,"auto_awesome"),s(),l(3," Query Active Page "),s()}}function Oe(o,d){o&1&&h(0,"mat-progress-bar",10)}var De=(o,d)=>d.value.id;function Ve(o,d){if(o&1&&(a(0,"mat-list-option",3),l(1),s()),o&2){let i=d.$implicit;c("value",i.value),r(),z(" ",i.label," ")}}var mt=(()=>{class o extends Te{aiservice=v(A);contentElement=R("chatContent");message=M("");messages=M([]);constructor(){super()}async sendMessage(i){i?.preventDefault();try{this.addUserMessage(this.message()),this.isProcessing.set(!0);let n=this.settingsService.settings(),e=await this.aiservice.chat(this.messages(),n,this.showAuthenticationAlert.bind(this));this.aiProcessingService.processResponse(e,n),this.message.set(""),e.chat?.length>0&&this.messages.set(e.chat),setTimeout(()=>{let t=this.contentElement()?.nativeElement;t&&(t.scrollTop=t.scrollHeight)},100)}catch(n){console.error(n),this.addUserMessage(n.message)}finally{this.isProcessing.set(!1)}}async summarizeActivePage(i=!1){let e=(await k("ChromeTabHelper","getAllTabs",{})).output?.map(t=>({name:t.id,value:{id:t.id,url:t.url,title:t.title},label:t.title,type:"radio",checked:!1}));e?.length===1?await this.processTab(e[0].value,i):e?.length>1?this.dialog.open(Ie,{width:"500px",data:{tabs:e}}).afterClosed().subscribe(m=>{m&&this.processTab(m,i)}):this.snackBar.open("No active tabs found","Dismiss",{duration:3e3})}async processTab(i,n){this.messages.set([]);let e=await k("ChromeTabHelper","getTabContent",{tabId:i.id}),t=this.message(),m=`If there is any #Question, please provide the answer to the question and then summarize the text below.
Analyze the text below and provide:
A detailed summary of the main ideas and supporting points.
A clear timeline of events, if applicable, in chronological order. The timeline should be presented as simple numbered or indented lines for readability, compatible with plain text formatting in Notepad.
Key highlights or important takeaways in a concise manner, using simple formatting like dashes or colons to separate items, avoiding Markdown or rich text styles.
Ensure the response uses plain text formatting compatible with Notepad for clear readability without advanced styling.

${t?.trim()?`#Question: ${t}`:""}

Text:${e.output?.replace(/\n/g," ")}`;n&&(m=`
#Query: ${t}
${e.output?.replace(/\n/g," ")}
			`),this.message.set(m),setTimeout(()=>{this.message.set(""),this.messages.set([{role:"user",text:`Summarize active page and user query: ${t}`,date:new Date}]),this.sendMessage(),this.messages.set([this.messages()[this.messages().length-1]])})}clearMessages(){this.messages.set([])}addUserMessage(i){i.trim()&&this.messages.update(n=>[...n,{role:"user",text:i,date:new Date}])}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=b({type:o,selectors:[["app-ai-chat"]],viewQuery:function(n,e){n&1&&V(e.contentElement,ke,5),n&2&&I()},features:[N([A,q]),O],decls:34,vars:8,consts:[["sidenav",""],["chatContent",""],[1,"chat-container"],["position","end","mode","side",3,"opened"],[3,"isCompactView"],[1,"toolbar-spacer"],["mat-icon-button","","title","Settings",3,"click"],[1,"chat-content"],[1,"message-list"],[3,"click"],["mode","indeterminate"],["appearance","fill",1,"message-input"],["matInput","","rows","1","placeholder","Type your message",3,"ngModelChange","keydown.enter","ngModel"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[1,"message-item"],[1,"message-avatar"],[1,"message-text"],[1,"wrapped-pre"]],template:function(n,e){if(n&1){let t=y();a(0,"mat-sidenav-container",2)(1,"mat-sidenav",3,0),h(3,"app-settings",4),s(),a(4,"mat-sidenav-content")(5,"mat-toolbar")(6,"span"),l(7,"AI Chat"),s(),h(8,"span",5),a(9,"button",6),u("click",function(){return p(t),g(e.toggleSideBarOpen("aiChat"))}),a(10,"mat-icon"),l(11,"settings"),s()()(),a(12,"div",7,1),F(14),f(15,Pe,3,0,"div",8),s(),a(16,"mat-chip-listbox")(17,"mat-chip",9),u("click",function(){return p(t),g(e.summarizeActivePage())}),a(18,"mat-icon"),l(19,"auto_awesome"),s(),l(20," Summarize Active Page "),s(),f(21,Ee,4,0,"mat-chip"),a(22,"mat-chip",9),u("click",function(){return p(t),g(e.clearMessages())}),a(23,"mat-icon"),l(24,"clear"),s(),l(25," Clear "),s()(),f(26,Oe,1,0,"mat-progress-bar",10),a(27,"mat-form-field",11)(28,"mat-label"),l(29,"Type your message"),s(),a(30,"textarea",12),u("ngModelChange",function(_){return p(t),g(e.message.set(_))})("keydown.enter",function(_){return p(t),g(e.sendMessage(_))}),s(),a(31,"button",13),u("click",function(){return p(t),g(e.sendMessage())}),a(32,"mat-icon"),l(33,"send"),s()()()()()}if(n&2){let t;r(),c("opened",(t=e.settings().sideBarOpen)==null?null:t.aiChat),r(2),c("isCompactView",!0),r(11);let m=$(e.messages());r(),C(m.length>0?15:-1),r(6),C(e.message()?21:-1),r(5),C(e.isProcessing()?26:-1),r(4),c("ngModel",e.message()),r(),c("disabled",e.isProcessing()||!e.message())}},dependencies:[K,H,U,j,se,ae,oe,W,E,ge,P,G,te,ee,_e,Ce,ne,ie,Z,X,Y,ye,we,xe,Me,be,ve,ue,Se],styles:[".wrapped-pre[_ngcontent-%COMP%]{white-space:pre-wrap;word-break:break-word;margin:0;font:inherit;font-size:.95rem;line-height:1.35}.chat-content[_ngcontent-%COMP%]{padding:16px 16px 156px;height:calc(100vh - 213px);overflow-y:auto}.chat-container[_ngcontent-%COMP%]{position:absolute;inset:0}mat-sidenav[_ngcontent-%COMP%]{width:300px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.chat-content[_ngcontent-%COMP%]{padding:16px;height:calc(100vh - 213px);overflow-y:auto}.chat-footer[_ngcontent-%COMP%]{position:fixed;left:0;right:0;bottom:0;padding:16px;background:var(--mat-background-color);z-index:2}.message-input[_ngcontent-%COMP%]{width:100%}.message-list[_ngcontent-%COMP%]{padding:0}.message-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;min-height:36px;padding:4px 0;margin-bottom:4px}.message-avatar[_ngcontent-%COMP%]{margin-right:8px;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:18px}.message-avatar.user[_ngcontent-%COMP%]{background:var(--mat-primary-color);color:var(--mat-primary-contrast-color)}.message-avatar.assistant[_ngcontent-%COMP%]{background:var(--mat-accent-color);color:var(--mat-accent-contrast-color)}.message-text[_ngcontent-%COMP%]{flex:1 1 0%;min-width:0;display:flex;align-items:flex-start;padding:4px 0}.chat-actions[_ngcontent-%COMP%]{margin:8px 0}.dark-theme[_nghost-%COMP%]   .chat-footer[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .chat-footer[_ngcontent-%COMP%]{background:#303030}"]})}return o})(),Ie=(()=>{class o{data=v(re);static \u0275fac=function(n){return new(n||o)};static \u0275cmp=b({type:o,selectors:[["tab-selection-dialog"]],decls:12,vars:4,consts:[["tabList",""],["mat-dialog-title",""],[3,"multiple"],[3,"value"],["align","end"],["mat-button","",3,"mat-dialog-close"],["mat-button","","color","primary",3,"mat-dialog-close","disabled"]],template:function(n,e){if(n&1&&(a(0,"h2",1),l(1,"Select Tab"),s(),a(2,"mat-dialog-content")(3,"mat-selection-list",2,0),x(5,Ve,2,2,"mat-list-option",3,De),s()(),a(7,"mat-dialog-actions",4)(8,"button",5),l(9,"Cancel"),s(),a(10,"button",6),l(11,"OK"),s()()),n&2){let t=B(4);r(3),c("multiple",!1),r(2),w(e.data.tabs),r(3),c("mat-dialog-close",null),r(2),c("mat-dialog-close",t.selectedOptions.selected[0].value)("disabled",!t.selectedOptions.selected.length)}},dependencies:[P,J,pe,le,me,de,ce,E,fe,he],encapsulation:2})}return o})();export{mt as AiChatComponent,Ie as TabSelectionDialogComponent};
